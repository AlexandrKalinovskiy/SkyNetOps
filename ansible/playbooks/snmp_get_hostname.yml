---
- name: Get SNMP sysName from all devices
  hosts: localhost
  gather_facts: no

  tasks:
    - name: Run SNMP GET for sysName
      ansible.builtin.command: >
        snmpget -v2c -c {{ snmp_community }} {{ ansible_host }} 1.3.6.1.2.1.1.5.0
      register: snmp_raw
      changed_when: false

    - name: Extract sysName string
      ansible.builtin.set_fact:
        sysname: "{{ snmp_raw.stdout | regex_replace('.*STRING:\\s*', '') | trim }}"

    - name: Emit sysname fact
      ansible.builtin.debug:
        var: sysname
